<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>OpenNMS Dashboard</title>

    <!-- Bootstrap Core CSS -->
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="../vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../dist/css/sb-admin-2.css" rel="stylesheet">

    <!-- Morris Charts CSS -->
    <link href="../vendor/morrisjs/morris.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">OpenNMS Dashboard</a>
            </div>
            <!-- /.navbar-header -->

            <!-- /.navbar-top-links -->

            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li class="sidebar-search">
                            <div class="input-group custom-search-form">
                                <input type="text" class="form-control" placeholder="Search...">
                                <span class="input-group-btn">
                                <button class="btn btn-default" type="button">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                            </div>
                            <!-- /input-group -->
                        </li>
                        <li>
                            <a href="index.html"><i class="fa fa-dashboard fa-fw"></i> Dashboard</a>
                        </li>
                        <li>
                            <a href="nodes.html"><i class="fa fa-server fa-fw"></i> Nodes</a>
                        </li>
                        <li>
                            <a href="events.html"><i class="fa fa-tasks fa-fw"></i> Events</a>
                        </li>
                        <li>
                            <a href="alarms.html"><i class="fa fa-bell fa-fw"></i> Alarms</a>
                        </li>
                        <li>
                            <a href="outages.html"><i class="fa fa-warning fa-fw"></i> Outages</a>
                        </li>
                        <li>
                            <a href="graphs.html"><i class="fa fa-bar-chart-o fa-fw"></i> Graphs</a>
                        </li>
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">Graphs</h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-md-12">
                    <div data-graph-report="mib2.traffic-inout" data-graph-resource="node[71].interfaceSnmp[wireless_0-18cf5ebc49b9]"
                         data-original-graph="rrda" data-graph-model="grapha"></div>
                </div>
                <div class="col-md-12">
                    <div id="rrda"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div data-graph-report="lmsensors.fan" data-graph-resource="node[35].lmFanIndex[5]"
                         data-original-graph="rrd9" data-graph-model="graph9"></div>
                </div>
                <div class="col-md-12">
                    <div id="rrd9"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div data-graph-report="mib2.tcpopen" data-graph-resource="node[44].nodeSnmp[]"
                         data-original-graph="rrd8" data-graph-model="graph8"></div>
                </div>
                <div class="col-md-12">
                    <div id="rrd8"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div data-graph-report="netsnmp.memStats" data-graph-resource="node[44].nodeSnmp[]"
                         data-original-graph="rrd7" data-graph-model="graph7"></div>
                </div>
                <div class="col-md-12">
                    <div id="rrd7"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div data-graph-report="netsnmp.hrMemory" data-graph-resource="node[44].nodeSnmp[]"
                         data-original-graph="rrd6" data-graph-model="graph6"></div>
                </div>
                <div class="col-md-12">
                    <div id="rrd6"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div data-graph-report="netsnmp.hrSystemProcesses" data-graph-resource="node[44].nodeSnmp[]"
                         data-original-graph="rrd5"></div>
                </div>
                <div class="col-md-12">
                    <div id="rrd5"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div data-graph-report="netsnmp.loadavg" data-graph-resource="node[44].nodeSnmp[]"
                         data-original-graph="rrd4"></div>
                </div>
                <div class="col-md-12">
                    <div id="rrd4"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div data-graph-report="netsnmp.cpuUsageFull" data-graph-resource="node[44].nodeSnmp[]"
                         data-original-graph="rrd3"></div>
                </div>
                <div class="col-md-12">
                    <div id="rrd3"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div data-graph-report="netsnmp.cpuStatsFull" data-graph-resource="node[44].nodeSnmp[]"
                         data-original-graph="rrd2"></div>
                </div>
                <div class="col-md-12">
                    <div id="rrd2"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div data-graph-report="icmp" data-graph-resource="node[44].responseTime[172.20.1.208]"
                         data-original-graph="rrd1"></div>
                </div>
                <div class="col-md-12">
                    <div id="rrd1"></div>
                </div>
            </div>
            <!-- /.row -->
        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <script src="../backshift/bower_components/jquery/dist/jquery.min.js"></script>
    <script src="../backshift/bower_components/d3/d3.min.js"></script>

    <script src="../backshift/bower_components/flot/jquery.flot.js"></script>
    <script src="../backshift/bower_components/flot/jquery.flot.time.js"></script>
    <script src="../backshift/bower_components/flot/jquery.flot.canvas.js"></script>
    <script src="../backshift/bower_components/flot-legend/jquery.flot.legend.js"></script>
    <script src="../backshift/bower_components/flot-axislabels/jquery.flot.axislabels.js"></script>
    <script src="../backshift/bower_components/flot.tooltip/js/jquery.flot.tooltip.min.js"></script>
    <script src="../backshift/bower_components/flot-saveas/jquery.flot.saveas.js"></script>
    <script src="../backshift/bower_components/flot-datatable/jquery.flot.datatable.js"></script>
    <script src="../backshift/bower_components/flot-navigate/jquery.flot.navigate.js"></script>

    <!--
    <script src="../backshift/bower_components/c3/c3.min.js"></script>

    <script src="../backshift/bower_components/crossfilter/crossfilter.min.js"></script>
    <script src="../backshift/bower_components/dcjs/dc.min.js"></script>
    -->

    <script src="../backshift/src/Compat.js"></script>
    <script src="../backshift/src/Backshift.js"></script>
    <script src="../backshift/src/Backshift.Class.js"></script>
    <script src="../backshift/src/Backshift.Class.Configurable.js"></script>
    <script src="../backshift/src/Backshift.Math.js"></script>
    <script src="../backshift/src/Backshift.Stats.js"></script>
    <script src="../backshift/src/Backshift.Utilities.Url.js"></script>
    <script src="../backshift/src/Backshift.Utilities.RpnToJexlConverter.js"></script>
    <script src="../backshift/src/Backshift.Utilities.Consolidator.js"></script>
    <script src="../backshift/src/Backshift.Utilities.RrdGraphVisitor.js"></script>
    <script src="../backshift/src/Backshift.Utilities.RrdGraphConverter.js"></script>
    <script src="../backshift/src/Backshift.DataSource.js"></script>
    <script src="../backshift/src/Backshift.DataSource.OpenNMS.js"></script>
    <script src="../backshift/src/Backshift.Graph.js"></script>
    <!--
    <script src="../backshift/src/Backshift.Graph.C3.js"></script>
    <script src="../backshift/src/Backshift.Graph.DC.js"></script>
    -->
    <script src="../backshift/src/Backshift.Graph.Flot.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="../vendor/metisMenu/metisMenu.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="../dist/js/sb-admin-2.js"></script>
    <script src="../dist/js/opennms.js"></script>
    <script type="text/javascript">
    $(document).ready(function () {
      end = Date.now();
      start = end - (8 * 60 * 60 * 1000);
        $("div[data-graph-report]").each(function () {
            var report = $(this).data('graph-report');
            var resource = $(this).data('graph-resource');

            var url = getBaseHref() + '/opennms/rest/graphs/' + encodeURIComponent(report);

            // Pull in the graph definition
            $.ajax({
                url: url,
                dataType: 'json',
                headers: {"Authorization": "Basic " + window.btoa(onmsUsername + ":" + onmsPassword)},
                xhrFields: {
                    withCredentials: true
                },
                context: $(this)
            }).done(function (graphDef) {
                // Convert the graph definition to a supported model
                var rrdGraphConverter = new Backshift.Utilities.RrdGraphConverter({
                    graphDef: graphDef,
                    resourceId: resource
                });
                var graphModel = rrdGraphConverter.model;

                // Build the data-source
                var ds = new Backshift.DataSource.OpenNMS({
                    url: getBaseHref() + "/opennms/rest/measurements",
                    username: onmsUsername,
                    password: onmsPassword,
                    metrics: graphModel.metrics
                });

                // Build and render the graph
                var graph = new Backshift.Graph.Flot({
                    width: "90%",
                    height: 480,
                    element: $(this)[0],
                    start: start,
                    end: end,
                    dataSource: ds,
                    model: graphModel,
                    step: false,
                    title: graphModel.title,
                    verticalLabel: graphModel.verticalLabel,
                    interactive: false,
                    beginOnRender: false
                });
                graph.render();
                setTimeout(function() {
                    graph.begin();
                }, 1000);

                // Pull in the RRD graph for comparison
                var rrdGraphImageUrl = "https://" + onmsUsername + ":" + onmsPassword + "@" + onmsHost + ":" + onmsPort + "/opennms/graph/graph.png?resourceId=" + resource +
                        "&report=" + encodeURIComponent(report) +
                        "&start=" + start +
                        "&end=" + end +
                        "&width=640&height=480";
              //  $('#' + $(this).data('original-graph')).prepend('<img src="' + rrdGraphImageUrl + '" />');

                // Show the resulting model if the div is defined
                $('#' + $(this).data('graph-model')).prepend("<pre>" + JSON.stringify(graphModel, null, 2) + "</pre>");
            });
        });
    });
    </script>
</body>

</html>
